<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('../partials/head'); %>
</head>
<body class="container">

<header>
  <%- include('../partials/header'); %>
</header>
<main>
	<div class="row mt-5">
    <div class="col">
	    	<h1 class="display-5">
	    		<strong>Update Grup</strong>
	    	</h1>
				<% if (typeof errors !== "undefined") { %>			
					<div class="alert alert-danger mt-2" role="alert">		  
						  <% errors.forEach(function(error) { %> 				   		
							<p><%= error.msg %></p>
					    <% }) %>
					</div>
				<% } %>
		</div>
		<div class="col">
			<form method="POST" action="/convocatorias/update/<%= convo.id %>">
				<div class="form-group">
                    <label for="data">Fecha:</label>
                    <input type="date" name="data" value="<%= convo.data %>">
               </div>
               <br>
               <div class="form-group">
                    <label for="horaInici">Hora de inicio:</label>
                    <input type="time" name="horaInici" value="<%= convo.horaInici %>">
               </div>
               <br>
               <div class="form-group">
                    <label for="durada">Duración:</label>
                    <input type="number" name="durada" value="<%= convo.durada %>"><br>
               </div>
               <br>
               <div class="form-group">
                    <label for="lloc">Lugar:</label>
                    <input type="text" name="lloc" value="<%= convo.lloc %>"><br>
               </div>
               <br>
               <div class="form-group">
                    
               </div>
               <br>
                <div class="form-group">
                    <label for="convocats">Convocats</label>
                    <select name="convocats[]" multiple class="form-control">
                        <% grupsList.forEach(function(grup) { %>
                            <% if (convo.convocats.includes(grup.id)) { %>
                              <option selected value="<%= grup.id %>"><%= grup.nom %></option>
                            <% } else { %>
                              <option value="<%= grup.id %>"><%= grup.nom %></option>
                            <% } %>
                          <% }); %>
                    </select>
                </div>
                <div class="form-group">
                    <label for="plantilla">Plantilla</label>
                    <select name="plantilla" multiple class="form-control">
                        <% plantillasList.forEach(function(plantilla) { %>
                            <% if (convo.plantilla == plantilla.id) { %>
                              <option selected value="<%= plantilla.id %>"><%= plantilla.nom %></option>
                            <% } else { %>
                              <option value="<%= plantilla.id %>"><%= plantilla.nom %></option>
                            <% } %>
                          <% }); %>
                    </select>
                </div>

                <div class="mb-3">
                    <label class="form-label">Orden del día</label>
                    <% convo.puntsOrdreDia.forEach(function(punt) { %>
                        <input type="text" name="puntsOrdreDia[]" class="form-control mb-3" value="<%= punt %>">
                    <% }); %>
                </div>
                
				<button type="submit" class="btn btn-primary">Save</button>
                <button type="button" id="addOrdreDia" class="btn btn-secondary">Agregar Orden del Día</button>
                <button type="button" id="deleteOrdreDia" class="btn btn-danger">Borrar Orden del Día</button>
                <a class="btn btn-danger" href="/convocatorias/delete/<%= convo._id %>" role="button">Delete</a>

			</form>
		</div>
	</div>

    <script>
        document.getElementById("addOrdreDia").addEventListener("click", function() {
          let input = document.createElement("input");
          input.type = "text";
          input.name = "puntsOrdreDia[]";
          input.classList.add("form-control");
          input.classList.add("mb-3");
        
          let label = document.createElement("label");
          label.classList.add("form-label");
          label.innerHTML = "Orden del día";
        
          let form = document.querySelector("form");
          form.insertBefore(input, document.querySelector("button[type='submit']"));
          form.insertBefore(label, input);
        });
    </script>
    <script>
        document.getElementById("deleteOrdreDia").addEventListener("click", function() {
            let inputs = document.getElementsByName("puntsOrdreDia[]");
            let lastInput = inputs[inputs.length-1];
            let lastLabel = lastInput.previousSibling;
            lastInput.remove();
            lastLabel.remove();
        });
    </script>

</main>

<footer>
  <%- include('../partials/footer'); %>
</footer>

</body>
</html>